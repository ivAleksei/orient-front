<ion-content [fullscreen]="true">
  <div class="page-layout">
    <div class="inline">
      <h3 class="page-title w-100">{{result?.event?.name}}<br>
        <small>{{result?.event?.organizer}}</small><br>
        <small><i class="mdi mdi-calendar"></i> {{result?.event?.dt_start| date: "dddd, DD/MM/YYYY HH:mm"}}</small><br>
        <small><i class="mdi mdi-pin"></i> {{result?.event?.location}}</small><br>
      </h3>
      <h3 class="page-title t-right name">{{result?.name}}<br>
        <span class="badge light">#{{result?.startnumber}}</span>
        <span class="badge light">{{result?.category}}</span>
      </h3>
    </div>
    <h3>{{i18n.lang.RACE_RESUME}}</h3>
    <ion-row>
      <ion-col size-xs="6" size-lg="2" *ngIf="result?.start_at">
        <div class="card">
          <h4>Partida</h4>
          {{result?.start_at | date: "HH:mm:ss"}}
        </div>
      </ion-col>
      <ion-col size-xs="6" size-lg="2" *ngIf="result?.end_at">
        <div class="card">
          <h4>Chegada</h4>
          {{result?.end_at | date: "HH:mm:ss"}}
        </div>
      </ion-col>
      <ion-col size-xs="6" size-lg="2">
        <div class="card">
          <h4>Tempo Total</h4>
          {{result?.time | time}}
        </div>
      </ion-col>
      <ion-col size-xs="6" size-lg="2" *ngIf="result?.route?.n_pcs">
        <div class="card">
          <h4>Controles</h4>
          {{result?.route?.n_pcs || (result?.status == 'OK' ? result?.splits?.length: '-')}}
        </div>
      </ion-col>
      <ion-col size-xs="6" size-lg="2" *ngIf="result?.route?.dist">
        <div class="card">
          <h4>Distancia</h4>
          {{result?.route?.dist}}
        </div>
      </ion-col>
      <ion-col size-xs="6" size-lg="2" *ngIf="result?.route?.climb">
        <div class="card">
          <h4>Elevação</h4>
          {{result?.route?.climb}}
        </div>
      </ion-col>
    </ion-row>
    <div *ngIf="result?.splits?.length">

      <h3>Tempo de Passagem nos PCs</h3>
      <div class="card">
        <div class="card-body">
          <table class="table dataTable">
            <thead>
              <tr>
                <th>Ponto</th>
                <th>Base</th>
                <th>Distância</th>
                <th>Tempo Parcial</th>
                <th>Acumulado</th>
                <th>Ritmo</th>
                <th>Obs.</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngIf="!result?.splits?.length">
                <td colspan="12">{{i18n.lang.NO_SPLIT_FOUND}}</td>
              </tr>
              <ng-template ngFor let-it let-i="index" [ngForOf]="result?.splits">
                <tr>
                  <td>{{i+1}}</td>
                  <td>{{it.num_base}}</td>
                  <td>-</td>
                  <td>{{it.time_partial | time}}</td>
                  <td>{{it.time_spent | time}}</td>
                  <td>-</td>
                  <td>-</td>
                </tr>
              </ng-template>
            </tbody>
          </table>
        </div>
      </div>
      <h3>Destaques e Análises</h3>
      <ion-row>
        <ion-col size-xs="6" size-lg="4">
          <div class="card">
            <h4><i class="mdi mdi-trophy-outline"></i> Split Mais Curto</h4>
            <p>Ponto {{best_split?.index}} (base {{best_split?.num_base}})</p>
            <p>Tempo: {{best_split?.time_partial | time}}</p>
            <p *ngIf="best_split?.pace">Ritmo: {{best_split?.pace | time}}/km</p>
          </div>
        </ion-col>
        <ion-col size-xs="6" size-lg="4">
          <div class="card">
            <h4><i class="mdi mdi-timer-outline"></i> Split Mais Longo</h4>
            <p>Ponto {{poor_split?.index}} (base {{poor_split?.num_base}})</p>
            <p>Tempo: {{poor_split?.time_partial | time}}</p>
            <p *ngIf="poor_split?.pace">Ritmo: {{poor_split?.pace | time}}/km</p>
          </div>
        </ion-col>
        <ion-col size-xs="12" size-lg="4">
          <div class="card">
            <h4> Trechos Críticos</h4>
            <p>
              Trechos mais lentos: Identificados por ritmo acima de X min/km
              Erros prováveis: Base 8 (diferença grande para média da categoria)
            </p>
            <p>
              Identifique como críticos os trechos com ritmo acima de um limite (ex.: 7:00/km) ou grandes desvios vs. a
              média da categoria.
            </p>
          </div>
        </ion-col>
      </ion-row>
      <h3>Gráficos</h3>
      <ion-row>
        <ion-col size-xs="12" size-lg="6">
          <div class="card">
            <div class="card-title">Tempo por Base (splits)</div>
            <div class="graph-place">
              <ngx-charts-bar-vertical-2d [results]="data_graph_splits" [gradient]="false" [xAxis]="true" [yAxis]="true"
                [legend]="false" [showXAxisLabel]="true" [showYAxisLabel]="true" [groupPadding]="0"
                [yAxisTickFormatting]="timePipe.transform">
              </ngx-charts-bar-vertical-2d>
            </div>
          </div>

        </ion-col>
        <!-- <ion-col size-xs="12" size-lg="6">
          <div class="card">
            <div class="card-title">Ritmo por Trecho</div>
            <div class="graph-place">
              <ngx-charts-bar-vertical-2d [results]="data_graph_pace" [gradient]="false" [xAxis]="true" [yAxis]="true"
                [legend]="false" [showXAxisLabel]="true" [showYAxisLabel]="true" [groupPadding]="0"
                [yAxisTickFormatting]="timePipe.transform">
              </ngx-charts-bar-vertical-2d>
            </div>
          </div>

        </ion-col> -->
        <ion-col size-xs="12" size-lg="12">
          <div class="card">
            <h4 class="card-title">{{i18n.lang.ROUTE}} {{result?.route_ref || '-'}}</h4>
            <ion-row>
              <ion-col size-xs="12" size-lg="4">
                <ion-item class="old-select">
                  <label for="state" position="stacked">Tipo de Gráfico*</label>
                  <select name="type_graph" [(ngModel)]="type_graph">
                    <option value="">Selecione uma opção...</option>
                    <option value="position_race">Posição de Prova</option>
                    <option value="position_split">Posição no Split</option>
                    <option value="time_spent">Tempo de Prova</option>
                    <option value="time_split">Tempo no Split</option>
                    <option value="table_result">Tabela Resultados</option>
                  </select>
                </ion-item>
              </ion-col>
              <ion-col size-xs="12" size-lg="4">
                <ion-item class="old-select">
                  <label for="state" position="stacked">Comparar outras categorias*</label>
                  <input type="checkbox" name="same_route" [(ngModel)]="same_route" (change)="getRouteResults()">
                </ion-item>
              </ion-col>
            </ion-row>
          </div>
          <ion-row>
            <ion-col size-xs="12" size-lg="4" [ngClass]="{hidden: type_graph == 'table_result'}">
              <div class="card">
                <div class="inline around">
                  <ion-button class="btn" (click)="setShowAll(true)">Todos</ion-button>
                  <ion-button class="btn" color="light" (click)="setShowAll(false)">Nenhum</ion-button>
                </div>
                <ng-template ngFor let-it [ngForOf]="data_results">
                  <ion-item>
                    <ion-checkbox justify="start" labelPlacement="end" name="show-{{it._id}}"
                      (ionChange)="setupChartRoute()" [(ngModel)]="it.show">
                      <span *ngIf="it.pos || it.status">({{it.pos || (it.status | status)}})</span>
                      {{it?.category?.name}}
                      {{it?.name}}</ion-checkbox>
                  </ion-item>
                </ng-template>
              </div>
            </ion-col>
            <ion-col size-xs="12" [attr.size-lg]="type_graph == 'table_result' ? 12 : 8">
              <div class="card">
                <div *ngIf="type_graph == 'table_result'">
                  <table id="tableResult" class="table dataTable">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>{{i18n.lang.NAME}}</th>
                        <th>{{i18n.lang.TIME}}</th>
                        <ng-template ngFor let-it [ngForOf]="result?.splits">
                          <th>{{it.num_base}}</th>
                        </ng-template>
                      </tr>
                    </thead>
                    <tbody>
                      <ng-template ngFor let-it [ngForOf]="data_results">
                        <tr>
                          <td>{{it.pos || (it.status | status)}}</td>
                          <td>{{it?.category?.name}} {{it?.name}}<br>{{it?.club?.name}}</td>
                          <td>{{it.time | time}}</td>
                          <ng-template ngFor let-sp [ngForOf]="result?.splits">
                            <td>{{it.obj_splits[sp.num_base]?.time_spent | time}}<br>
                              {{it.obj_splits[sp.num_base]?.time_split | time}}
                            </td>
                          </ng-template>
                        </tr>
                      </ng-template>
                    </tbody>
                  </table>
                </div>
                <div class="graph-place" *ngIf="type_graph == 'position_race'">
                  <ngx-charts-line-chart [results]="data_position_race_graph" [gradient]="true" [xAxis]="true"
                    [yAxis]="true" [legend]="false" [showXAxisLabel]="true" [showYAxisLabel]="true">
                  </ngx-charts-line-chart>
                </div>
                <div class="graph-place" *ngIf="type_graph == 'position_split'">
                  <ngx-charts-line-chart [results]="data_position_split_graph" [gradient]="true" [xAxis]="true"
                    [yAxis]="true" [legend]="false" [showXAxisLabel]="true" [showYAxisLabel]="true">
                  </ngx-charts-line-chart>
                </div>
                <div class="graph-place" *ngIf="type_graph == 'time_spent'">
                  <ngx-charts-line-chart [results]="data_time_spent_graph" [gradient]="true" [xAxis]="true"
                    [yAxis]="true" [legend]="false" [showXAxisLabel]="true" [showYAxisLabel]="true"
                    [yAxisTickFormatting]="timePipe.transform">
                  </ngx-charts-line-chart>
                </div>
                <div class="graph-place" *ngIf="type_graph == 'time_split'">
                  <ngx-charts-line-chart [results]="data_time_split_graph" [gradient]="true" [xAxis]="true"
                    [yAxis]="true" [legend]="false" [showXAxisLabel]="true" [showYAxisLabel]="true"
                    [yAxisTickFormatting]="timePipe.transform">
                  </ngx-charts-line-chart>
                </div>
              </div>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
    </div>

    <div>
      <h3>Mapa</h3>
      <div class="map-place">
        <img src="assets/baseorient/imgs/mapa_template.png" alt="map_template">
      </div>
    </div>
    <div class="inline between">
      <div>
        <h4>Links úteis</h4>
        <a href="https://helga-o.com/webres/index.php?lauf={{result?.event?._helga}}&lang=pt#{{result?.category}}"
          target="_blank">Helga WebRes</a>
        <h4 *ngIf="result?.event?.organizer">Organizador</h4>
        <h4 *ngIf="result?.event?.apura">Apuração</h4>
        <p *ngIf="result?.event?.apura == 'sicard'">SICard</p>
        <p *ngIf="result?.event?.apura == 'siac'">SIAC</p>
        <p *ngIf="result?.event?.apura == 'qrcode'">QR Code</p>
        <p *ngIf="result?.event?.apura == 'stamp'">Grampo</p>
      </div>
      <div>
        <div class="qrcode-place ">
          <div class="qr-place" *ngIf="public_url">
            <qrcode [qrdata]="public_url" [width]="112" [errorCorrectionLevel]="'M'"></qrcode>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>